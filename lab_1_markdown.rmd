---
title: "Lab 1"
author: "Jimmy, Gabrielle, and Zev" 
date: today 
date-format: short 
format: 
  pdf: 
    documentclass: scrartcl
    classoption: onecolumn
editor: visual
---

```{r load packages, include=FALSE}
library(tidyverse) 
library(magrittr)
library(knitr)
library(patchwork)
library(moments)
library(here)
```

```{r set options, include=FALSE}
theme_set(theme_bw())

knitr::opts_chunk$set(echo=FALSE, message=FALSE)
```

```{r load data}
anes <- read_csv(("anes_timeseries_2024_csv_20250430.csv"))
```

```{r}
anes = anes %>% 
  filter( V241264 > 0 ) %>% 
  filter(V241261>0) #filter out unknown values
anes$V241264 <- c(1,3,2)[df$V241264] #recode public schools
anes$V241261 <- c(1,3,2)[df$V241261] #recode social security so 1 = increase, 2= same, 3 = decrease
anes$Difference = anes$V241264 - anes$V241261

#Split into democrats and republicans according to party affiliation summary variable
democrats = anes %>% filter(V241227x %in% c(1,2,3))
republicans = anes %>% filter(V241227x %in% c(5,6, 7))

#Create histograms of difference by each partty
hist(democrats$Difference, breaks = 20)
mean(democrats$Difference)
hist(republicans$Difference, breaks = 20)
mean(republicans$Difference)

```

\newpage

# Introduction

We suspect that Democrats will favor increasing spending in public schools more than social security. Whereas Republicans will be the other way around. So we will set up two hypothesis test using the Wilcoxon Signed Rank test.

\

Test set up:

Let Xi​ = preference for **public school spending (**V241264)**, where:**

-   1 = Increased

-   2 = Kept the same

-   3 = Decreased

\

Let Yi​ = preference for **social security spending (**V241261)**,** with the same code as Xi

Let Di = Xi - Yi, with interpretation:

-   -2 represents public schools =1 (Increase) **vs.** social security =3 (Decrease): extremely more support for schools

-   -1 represents public schools =1 (Increase) **vs.** social security =2 (Same), **or** public schools =2 (Same) **vs.** social security =3 (Dec): more support for schools

-   0 represents public schools and social security  coded the same: equal support (both Increase, both Same, or both Decrease)

-   1 represents public schools =2 (Same) **vs.** social security =1 (Increase), **or** public schools =3 (Dec) **vs.** social security =2 (Same): more support for Social Security

-   2 represents public schools =3 (Decrease) **vs.** social security =1 (Increase): extremely more support for Social Security

**Test 1:**

Null hypothesis (Ho): average Di \| i in Democrats = 0

Alternative hypothesis (H1): average Di \| i in Democrats \< 0 , favoring public schools

**Test 2:\
** Null hypothesis (Ho): average Di \| i in Republicans = 0

Alternative hypothesis (H1): average Di \| i in Republicans \> 0 , favoring social security

\
\
\

![](https://lh7-rt.googleusercontent.com/docsz/AD_4nXdWUN1tXWxgggdW2boPvKwir_rgex21KPwdzYKV1-0Fu51quFgROW34s1N_gDKwzvuIS22kSRR37hMXp27zf8zustuhSRXw0mTVV2A5KPwMjKO4L9hlhSvdCKD1XDmvMg9PKJCq?key=G8FEKJq-yxtkOZ8NldKe4w)

I

# Data and Methodology

```{r}

```

```{r make summary table}
summary_table <- anes %>% 
  mutate(
    print_vote_2016 = case_when(
      voted_2016 ~ "Voted 2016", 
      !voted_2016 ~ "Did not Vote 2016"), 
    print_vote_2018 = case_when(
      voted_2018 ~ "Voted 2018", 
      !voted_2018 ~ "Did not Vote 2018")) %$% 
  prop.table(
    table(
      print_vote_2016, 
      print_vote_2018))
```

```{r summary-table}
#| label: tbl-summary
#| tab-cap: "Self-Reported Voting Behavior in 2016 and 2018"
kable(
  summary_table,
  digits = 2,
  booktabs = TRUE, 
)
```

```{r fear-anger-joint}
fear_anger_joint <- anes %>% 
  ggplot(aes(x = geangry, y = geafraid)) + 
  geom_jitter(alpha = 0.20) + 
  labs(
    x = "Anger", y = "Fear", 
    title = "Fear & Anger Relationship") 
```

```{r turnout-by-emotion}
turnout_by_emotion <- anes %>% 
  select(voting_change, emotions) %>%
  group_by(emotions) %>% 
  summarise(
    increase = mean(voting_change == 1), 
    decrease = mean(voting_change == -1)) %>% 
  ggplot() + 
  geom_col(
    aes(
      x=emotions, y=increase, 
      fill = "Increase"),
    width = 0.5,
    position = "stack") +
  geom_text(
    aes(
      x=emotions, y=increase, 
      label=paste(formatC(100 * increase,digits=1, format="f"), "%")),  
    hjust=1, 
    colour="white") +
  geom_col(
    aes(
      x=emotions, y=-decrease, 
      fill="Decrease"),
    width=0.5,
    position="stack") +
  geom_text(
    aes(
      x=emotions, y=-decrease, 
      label=paste(formatC(100 * decrease,digits=1, format="f"), "%")),  
    hjust=-.1, 
    colour = "white") +
  annotate("text", x=3.7, y=-0.0008, label="< Decrease   Increase >") +
  geom_hline(yintercept=0) +
  expand_limits(x=4) +
  scale_y_continuous(limits=c(-.065, .065)) +
  labs(
    title="Changes in Voting Behavior", 
    fill="Voting Behavior", 
    x=NULL, 
    y="Fraction of Subjects") +
  theme(legend.position="none") +
  coord_flip()
```

```{r plots}
#| label: fig-plots
#| fig.cap: 'Voter Emotions and Voter Turnout. The red series did not vote; the blue series did vote.'
#| fig.pos: t
#| fig.height: 3

(fear_anger_joint | turnout_by_emotion)
```

# Results

```{r t-test, echo=TRUE}
test <- anes %>% 
  filter(emotions %in% c("More Anger", "More Fear")) %$% 
  t.test(voting_change == 1 ~ emotions)
```

```{r produce differences}
#| warning: false
differences <- anes %>% 
  filter(
    voted_2016 == FALSE, 
    voted_2018 == TRUE, 
    geangry != geafraid) %>% 
  summarise(
    more_angry = geangry > geafraid, 
    more_afraid = geangry < geafraid)
```

```{r produce difference in new voter percentage}
new_voters <- anes %>% 
  filter(emotions %in% c("More Anger", "More Fear")) %>% 
  group_by(emotions) %>% 
  summarise(percent =  round(mean(voting_change==1) * 100, 2))
```

# Discussion
